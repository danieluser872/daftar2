<!DOCTYPE html>
<html lang="en">

<!-- 
XXNWMMMMMMMMMWMMMMMWMMMMMWWKKKkONWWWWWWWWWWMWWWWWWWWWWMMWMMMMMMMMMMMWx:,'lKWWWWWWWWWWMWMMMMMMMWNXKXX
KNWMMWWMMMMMMMMMMMMWWWWWWWWWX0OKWWWWWWWMWWMMWMWMMMMMMMMMMMMMWWMMMMMMWd:c'.'lkXWMWMMMMMMMMMMMMMMMWNXX
XWWWWWMMMMMMMWWWWWWWWWWWWMWWWNNWMMMMWMMMMMWMMMMMMMMMMMMMMMMMMWWMMMMMXlco:'...,codxxkkxxONMWMMMMMMMWW
NWWWWWMMMMWWWWWWWWWWWNNWWMWMMWWMMMMMMMMMMWWWMMMMMMMMMMMMMMMMMWNNWMMWxcodo:'.'........;xKWMWNNWMMMMMM
WWWWWWMMWWWWWWWWWWWMWXXMWMMMMMMMMMMMMMMMMWXNMMMMMMMMMMMMMMMMMMWNXWNxclddddd:,,'....,xNMMMMMWXXNWWNWM
WWWWWWMMWWWWWWMWMMMMW0KMMMMMMMMMMMMMMMMMMN0XWMMMMMMMMMMMMMMMMMMWKkocodddoooc;.....:KMMMMMMMMNK0KXXXX
WWWWWWWWWMMMMMMMMMMMKx0MMMMMMMMMMMMMMMMMMXxOWMMMMMMMMMMMMMMMMWKxl:clllllcclc;....,0MMMMMMMMMWNK00KXK
WWWMWMMMMMMMMMMMMMMNko0MMMMMMMMMMMMMMMMMMXxxXMMMMMMMMMMMMMMMNKxodolc::ccloool,...oWMMMMMMMMMMMN0000K
MMMMMMMMMMMMMMMMMMW0xdOWMMMMMMMMMMMMMMMMMXxdOXMMWNNXXXXXXXNNNNWWWWX0Oddkkolloc...kMMMMMMMMMMMMWX0000
MMMMMMMMMMMMMMMMMMXkOxxXMMMMMMMMMMMMMMMMMXkk0O0KKKKKKXXXXNNNNNWWWWNKXXOKWX0xoc,.'OMWMMMMMMMMMMMNKKK0
MMMMMMMMMMMMMMMMMNOOX0dOWMMMMMMMMMMMMMMMMNkON0xkKWMMMMMMMMMMMMMMMMWXKKO0NNWWXOo;,xNWMMMMMMMMMNKOxxxx
MMMMMMMMMMMMMMMMW0kKNXOxOKKXNMMMMMMMMMMMMWOONNXK0KKKXNWMMMMMMMMMMMMNK00O0KXNWWWX000OOO0KXXXKOOO00OkO
MMMMMMMMMMMMWWWMXkOKK00kdkKKNMMMMMMMMMMMMW0kXNNNNNNXK0KKXNWMMMMMMMMWXOOKK00KXXNWWWWWXKOOkdokKNWNKKNW
MMMMMMMMMMMMWNWWOk0KXNNX0kOXWMMMMMMMMMMMMMKkKWWWWWWWWNXK0000KXNNWWWWXKOONX0OO0KKKXNWWWWXOOXWWWKO0NWW
MMMMMMMMMMMMWNNKx0NNNNNNNKkxKNMMMMMMMMMMMMWO0WWWWWWWWWWWWNXKK00OOOOKKKKO0WWN0OxkOO0KKXKk0NWWN0x0WWNK
MMMMMMMMMMMMWXKkkXWNNNWWWWN0xOXWMMMMMMMMMMMXOXWWWWWWWWWWWWWWWWWNK0OkkxxddKMMMN0kxxkOkkxdkNWNNOxKWNNO
MMMMMMMMMMMMNKOx0NWWWWWNNWWNKkxkKWMMMMMMMMMWK0NWWWWWWWWWWWWWWWWWWWWWNX0OxkNMMMMWKkdodxkxdxOXNXkkXNN0
MMMMMMMMMMMMN0dxXWWWWWWKkOXXXK0xoxKNXNMMMMMMWKKWWWWWWWWWWWWWWWX0NWNWWN0KXOKMMMMMMWXOxoodxdodxO0kOKXX
MWWMMMMMMMMMXkokXKOOOxl:..',:ldkO0KK0O0XWMMMMNKKWWWWWWNNXXXNWXl:x000kclKWKONMMMMMMMWN0xdoodkxdoddxOK
WNWMMMMMMMMMKdoOXXo'.  ..     .cdOXXK0kxk0KXWMNKXWWWWWXK0K0kl'   ... .l0XXOKMMMMMWNNNXX0kdllxOkxdooo
XXWMMMMMMMMM0ook0x;..,l:.......:OKXNWNXKOO00KKXXKKXNWWNN0d:,;cloooollcd0XXOOWN0O0KKK00K0OOkxOKKKKK0O
KXWMMMMMMMMWOcokxc..:xOd;''cxd;.cXWWWWWWNXNWWWNNNXKNWWWXkxOXNWNNNNNNNNNNNXkxOxOXWWWWWWWNNNNNNNNNNNXX
KNMMMMMMMMMNkco0N0;'o0N0l',OWWk..kWWWWWWWWWWWWWWWWWWWWWWWWWWNNNNNNNNNNNNNKxdkkO000OOOOOOkkkOOO000KKK
KNMMMMMMMMWXxclOXNOlxXWx...ck0d,,kWWWWWWWNNWWWWWWWWWWWWWWWWWNNNNNNNNNNNNNKxdKWXK0Okkkkkkkkxxxxxxxxxx
KNMMMMMMMMWKxood0XNXKNWXc.',:clloKWWWWWWWNNWWWWWWWWWWWWWWWWWNNNNNNNNNNNNN0ol0MMMMMMMMMMWWWXK00000000
XWMMMMMMMMXOxdkxdOXNNNWWXx::clld0WWWWWWWWWWWWWWWWWWWWWWWWWWWNNNNNNNNNNNNNkccOMMMMMMMMMMMMMWX00000000
XWMMMMMMMWKOdoxkxdkXNNNNNNKOOO0XNWWWWWWWWWWWWWWWWWWWWWWWWWWWNNNNNNNNNNNN0odx0MMMMMMMMMMMMMWXK0000000
XWMMMMMMMNKOxdddxxoxXNNNNNNNNNNNNWWWWWWWWWWWWWWWWWWNXK00NWWWNNNNNNNNNNNKddOx0MMMMMMMMMMMMMNKK0000000
NMMMMMMMWXKOkOOxdddoxXNNNNNNNNNNNWWWWWWWWWWWWWWWWX0Oxkk0NWNNNNNNNNNNNN0ddOOkXMMMMMMMMMMMMWXK00000000
NMMMMMMMNXKOOO00OdoolkXNNNNNNNNNWWWWWWWNXXXNNNNXKOOO0KNNWNNNNNNNNNNNXOdxO0kONMMMMMMMMMMMMNK0O0K00000
NMMWWMMWWX0OO00000kxolkXNNNNNNNNWWWWWWWNXXXXXNNXNNWWWNNNNNNNNNNNNNN0xxO00OkKMMMMMMMMMMMMNXKOO0000000
NMWXWMWWWX00000000O00kdxKNNNNNNNWWWWWWWWWWWWNNNNNWWNNNNNNNNNNNNNX0xxk000Ok0WMMMMMMMMMMMWXK0O0KKK0000
WWXXWMWWNK00O00000OO00Oxdx0XNNNNNNWWNNWWWWNNNWNNNNNNNNNNNNNNNNKOxxk0000OkONWWMMMMMMMMMWXK0OOK0KKKKKK
WNKXWMMMN000O00000OOO000OkxkO0XNNNNNNNNNNNNNNNNNNNNNNNNNNNNX0kolx000O00kONWNWMMMMMMMMWXK0OOKKKKKKKKK
NK0XWMMWX000000000OOOOO0000OOkkOO00KXNNNNNNNNNWNNNNXKK00OOxl:llcoxdxxxk0NXXWMMMMMMMWNXK0xk0KKKKKKKKK
XK0XWMMNK000000O00OkkOOO0O00000OOkxkkkkkO00kxollc:;;,''.............:x0KKXWMMMMMMMWNKKOddOKKKKKKKKKK
K00XWMWXK000KKK0000kxkOOO000000O000Oxl,..''.......................;cdxkKWMMMMMMMWNXK0x;'lO000KKKKKKK
000KWMWX000KNNNNXK0OkkkxkOO000Oxoc;,.............................',',dXMMMMMMMWWXK0x:. .o000KKKKKKKK
000KNMWK000KNNNNWNX0OkOOxdddo:,.................................  .:OWMMMMMMWWXKOd,.   'k0O0KKKKKKKK
O00KNMNKKKKKKXNNNNXKKKXNX0o'. ...................................;xXWMMMMMWNX0xc.     .lOO0KKKKKKKKK
O00KXWNKXNNNXXKKXXXNNNNNKo.   ................................'ckXWMMMMWNXOdc'.       ;kO0KKKKKKKKKK
O0K0KWNKKXNNNXXXKKXXXKKKk:.    ..........................,:ldOXWMMWWXKkdc,.          'dO0KKKKKKKKKKK
OO0KKXXK00KKKKKXXXXNXX00OOx:.            ...............',;clodddol:,...            'ok0KKKKKKKKKKKK
xxkOOOOOOOOkkkkkOkxxkOOkkkkkd:.        ...................................         'ldkOOOOOOOOOOOOO
''''''''''''''''..  ....''''''...        ,l'.:..;,..     ':..:,                   ...'''''''''''''''
................          .......;:,.,;. ,c.lX:'0x'..,;,';kOOk,.;;;.             ...................
.................               lKOO0k0k.c0,cW0ONx''oOdxO;,0O,ckdkKc           .....................
..................             .xO,d0,oX:oX;lNdlXd.;Od.,0l.kx,kx.'Od         .......................
...................            .ld.cx''xkko.:k,.dl..;ddxo..oo.,ddxo'       .........................
....................            .. ..  ...  ... ..   ...   ..   ..       ...........................
-->

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><?= $title; ?></title>
  <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css" />-->
  
  <link rel="stylesheet" type="text/css" href="<?= base_url() . 'assets/bootstrap/4/css/bootstrap.css' ?>" />
  <link rel="stylesheet" type="text/css" href="<?= base_url() . 'assets/bootstrap/dataTables/css/dataTables.bootstrap4.min.css' ?>" />
  
</head>

<body>


  <!-- Nav Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <!--style="width: 120%;"-->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="<?= base_url('index.php/daftar_c/vdaftar') ?>">Pendaftaran <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="<?= base_url('index.php/daftar_c/vperiksa') ?>">Pasien<span class="sr-only">(current)</span></a>
        </li>
      </ul>
      <!--<button class="btn btn-danger my-2 my-sm-0" type="submit">Log Out</button>-->
      <a href="<?= base_url() . 'index.php/daftar_c/logout' ?>" class="btn btn-danger my-2 my-sm-0">Log Out</a>
    </div>
  </nav>
  <!--End Nav Bar-->

  <div class="container mt-3">
    <!--<h3>Pendaftaran</h3>-->
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary mb-3" onclick="tambahData()">
      Tambah Pasien
    </button>


    <!-- Modal -->
    <div class="modal fade" id="modalData" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">#</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body form">

            <form action="#" id="formData">
              <input type="hidden" id="id" name="id" value="">
              <div class="form-group">
                <label for="kd_pasien">Kode Pasien</label>
                <input type="text" class="form-control col-md-6" id="kd_pasien" name="kd_pasien" readonly="readonly" placeholder="Kode Pasien">
              </div>
              <!--<div class="form-group">
                <label for="prefix">Prefix</label>
                <input type="text" class="form-control col-md-4" id="prefix" name="prefix" placeholder="Prefix">
              </div>-->

              <div class="form-group">
                <label for="prefix">Prefix</label>
                <select name="prefix" class="form-control col-md-4" id="prefix">
                  <option value="">Pilih Prefix</option>
                  <option value="Tn">Tn</option>
                  <option value="Ny">Ny</option>
                  <option value="Nn">Nn</option>
                  <option value="An">An</option>
                </select>
                <div class="invalid-feedback"></div>
              </div>

              <div class="form-group">
                <label for="nama_pasien">Nama Pasien</label>
                <input type="text" class="form-control" id="nama_pasien" name="nama_pasien" placeholder="Nama Pasien">
                <div class="invalid-feedback"></div>
              </div>
              <div class="form-group">
                <label for="nama_kk">Nama KK</label>
                <input type="text" class="form-control" id="nama_kk" name="nama_kk" placeholder="Nama KK">
                <div class="invalid-feedback"></div>
              </div>
              <div class="form-group">
                <label for="no_kk">No KK</label>
                <input type="text" class="form-control" id="no_kk" name="no_kk" placeholder="No KK">
              </div>
              <div class="form-group">
                <label for="alamat">Alamat</label>
                <input type="text" class="form-control" id="alamat" name="alamat" placeholder="Alamat">
                <div class="invalid-feedback"></div>
              </div>
              <div class="form-group">
                <label for="alamat">Usia</label>
                <input type="number" class="form-control col-md-4" id="usia" name="usia" placeholder="Usia" pattern="/^-?\d+\.?\d*$/" onKeyPress="if(this.value.length==4) return false;">
                <div class="invalid-feedback"></div>
              </div>
            </form>


          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="btnSave" onclick="simpanData()">Tambah</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">Batal</button>
          </div>
        </div>
      </div>
    </div>


    <div class="card">
      <!--style="width:135%"-->
      <div class="card-body">
        <table id="tbDaftar" class="table table-bordered mr-n2">
          <thead style="text-align: center;">
            <tr>
              <th>No</th>
              <th>Kode Pasien</th>
              <th>Prefix</th>
              <th>Nama Pasien</th>
              <th>Nama KK</th>
              <th>No KK</th>
              <th>Alamat</th>
              <th>Usia</th>
              <th style="width: 200px;">Aksi</th>
            </tr>
          </thead>
          <tbody style="text-align: center;">

          </tbody>
        </table>

      </div>
    </div>
  </div>

  <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


  <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script> -->
  
  <script src="<?= base_url() . 'assets/js/jquery-3.3.1.slim.min.js' ?>"></script>
  <script src="<?= base_url() . 'assets/js/jquery-3.6.0.js' ?>"></script>

 
  <script src="<?= base_url() . 'assets/bootstrap/4/js/popper.min.js' ?>"></script>
  <script src="<?= base_url() . 'assets/bootstrap/4/js/bootstrap.min.js' ?>"></script>


  <script src="<?= base_url() . 'assets/bootstrap/dataTables/js/jquery.dataTables.min.js' ?>"></script>
  <script src="<?= base_url() . 'assets/bootstrap/dataTables/js/dataTables.bootstrap4.min.js' ?>"></script>

  <script>
    var btnData;
    var modal = $('#modalData');
    var tbData = $('#tbDaftar');
    var formData = $('#formData');
    var modalTitle = $('#modalTitle');
    var btnSave = $('#btnSave');

    $(document).ready(function() {
      tbData.DataTable({
        "processing": true,
        "serverSide": true,
        "order": [],
        "ajax": {
          "url": "<?php echo base_url() . "index.php/daftar_c/ambilData" ?>",
          "type": "POST"
        },
        "columnDef": [{
          "target": [-1],
          "orderable": false
        }]
      });
    });

    //fungsi reload datatable
    function reloadTable() {
      tbData.DataTable().ajax.reload();
    }

    //fungsi form modal
    function tambahData() {
      btnSave.text('Tambah');
      btnData = 'tambah';
      formData[0].reset();
      modal.modal('show');
      modalTitle.text('Form Tambah Pasien Baru');
      formData.find('select').removeClass('is-invalid');
      formData.find('input').removeClass('is-invalid');
	  
	  $.ajax({
        type: "GET",
        url: "<?= base_url() . "index.php/daftar_c/testData" ?>",
        //data: "data",
        dataType: "json",
        success: function(hasil) {
          var x = parseInt(hasil);
          var y = x + 1;
          var z = y.toString();
          //console.log(z);
          if (hasil >= 0) {
            $('[name="kd_pasien"]').val("AA" + z);
          }
        }
      });
	  
    }
    //fungsi simpan data
    function simpanData() {
      btnSave.text('Mohon Tunggu....');
      btnSave.attr('disabled', true);
      if (btnData == 'tambah') {

        url = "<?php echo base_url() . "index.php/daftar_c/tambahData" ?>";
      } else if (btnData == 'ubah') {
        url = "<?php echo base_url() . "index.php/daftar_c/ubahData" ?>";
      } else {
        alert('error');
      }
      $.ajax({
        type: "POST",
        url: url,
        data: formData.serialize(),
        dataType: "JSON",
        success: function(simpan) {
          if (simpan.status == 'success') {
            modal.modal('hide');
            reloadTable();
            //location.reload();
          } else {
            for (i = 0; i < simpan.inputerror.length; i++) {
              $('[name="' + simpan.inputerror[i] + '"]').addClass('is-invalid');
              $('[name="' + simpan.inputerror[i] + '"]').next().text(simpan.error_string[i]);
            }
          }
          btnSave.text('Simpan data');
          btnSave.attr('disabled', false);
        },
        error: function() {
          console.log('Error Database');
        }
      });
    }

    //fungsi ambil data by id
    function byid(id, type) {
      if (type == 'ubah') {
        btnData = 'ubah';
        formData[0].reset();
      }
      $.ajax({
        type: "GET",
        url: "<?= base_url() . "index.php/daftar_c/byid/" ?>" + id,
        dataType: "JSON",
        success: function(getid) {
          if (type == 'ubah') {
            formData.find('input', 'select').removeClass('is-invalid');
            formData.find('select').removeClass('is-invalid');
            modalTitle.text('Form Ubah Data Pasien');
            btnSave.text('Ubah');
            btnSave.attr('disabled', false);
            $('[name="id"]').val(getid.id);
            $('[name="kd_pasien"]').val(getid.kode_pasien);
            $('[name="prefix"]').val(getid.prefix);
            $('[name="nama_pasien"]').val(getid.nama_pasien);
            $('[name="nama_kk"]').val(getid.nama_kk);
            $('[name="no_kk"]').val(getid.no_kk);
            $('[name="alamat"]').val(getid.alamat);
            $('[name="usia"]').val(getid.usia);
            modal.modal('show');
          } else if (type == 'hapus') {
            var result = confirm('Apakah akan menghapus pasien ' + getid.nama_pasien);
            if (result) { //jika ditekan ok
              hapusData(getid.id);
            }
          } else if (type == 'periksa') {
            var id = getid.id;
            var kode_pasien = getid.kode_pasien;
            var prefix = getid.prefix;
            var nama_pasien = getid.nama_pasien;
            var nama_kk = getid.nama_kk;
            var no_kk = getid.no_kk;
            var alamat = getid.alamat;
            var usia = getid.usia;
            $.ajax({
              type: "POST",
              url: "<?= base_url('index.php/daftar_c/periksa/') ?>" + id,
              data: 'kd_pasien=' + kode_pasien + '&prefix=' + prefix + '&nama_pasien=' + nama_pasien + '&nama_kk=' + nama_kk + '&no_kk=' + no_kk + '&alamat=' + alamat + '&usia=' + usia,
              dataType: "JSON",
              success: function(response) {
                alert('Data Periksa Pasien ' +getid.nama_pasien+ ' Berhasil Ditambahkan');
              }
            });
          } else {

          }
        }
      });
    }
    //fungsi hapus data
    function hapusData(id) {
      $.ajax({
        type: "POST",
        url: "<?= base_url('index.php/daftar_c/hapusData/') ?>" + id,
        dataType: "JSON",
        success: function(hapus) {
          reloadTable();
        }
      });
    }
  </script>

</body>
<footer>
  <p style="text-align: center;"><i class="fa fa-copyright" aria-hidden="true">Copyright &copy; <?= $copy; ?> <?= date("Y"); ?> </i></p>
</footer>

</html>